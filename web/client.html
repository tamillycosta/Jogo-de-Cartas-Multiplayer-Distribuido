<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Teste WebSocket Pub/Sub</title>
  <style>
    body { font-family: Arial; padding: 1rem; }
    input, button { margin: .5rem 0; }
    #log { white-space: pre-wrap; background: #eee; padding: 1rem; height: 200px; overflow-y: auto; }
  </style>
</head>
<body>
  <h2>Teste de ConexÃ£o WebSocket</h2>

  <button id="connectBtn">Conectar</button>
  <button id="disconnectBtn">Desconectar</button>
  <br />

  <input id="topicInput" placeholder="tÃ³pico (ex: jogo.cartas)" />
  <button id="subscribeBtn">Inscrever</button>
  <button id="unsubscribeBtn">Desinscrever</button>
  <br />

  <textarea id="dataInput" rows="3" cols="40" placeholder='mensagem JSON (ex: {"carta":"A"})'></textarea>
  <br />
  <button id="publishBtn">Publicar</button>

  <h3>Log:</h3>
  <div id="log"></div>

  <script>
    let socket;
    const logDiv = document.getElementById('log');

    function log(msg) {
      logDiv.textContent += msg + "\n";
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    document.getElementById('connectBtn').onclick = () => {
      socket = new WebSocket("ws://localhost:8080/ws");

      socket.onopen = () => log("Conectado ao servidor WebSocket");
      socket.onclose = () => log("ConexÃ£o fechada");
      socket.onerror = (e) => log("Erro: " + e.message);
      socket.onmessage = (msg) => log("ðŸ“© Recebido: " + msg.data);
    };

    document.getElementById('disconnectBtn').onclick = () => {
      if (socket) socket.close();
    };

    document.getElementById('subscribeBtn').onclick = () => {
      const topic = document.getElementById('topicInput').value;
      socket.send(JSON.stringify({ type: "subscribe", topic }));
      log("ðŸŸ¢ Solicitado subscribe em: " + topic);
    };

    document.getElementById('unsubscribeBtn').onclick = () => {
      const topic = document.getElementById('topicInput').value;
      socket.send(JSON.stringify({ type: "unsubscribe", topic }));
      log("ðŸ”´ Solicitado unsubscribe em: " + topic);
    };

    document.getElementById('publishBtn').onclick = () => {
      const topic = document.getElementById('topicInput').value;
      const data = JSON.parse(document.getElementById('dataInput').value || "{}");
      socket.send(JSON.stringify({ type: "publish", topic, data }));
      log("ðŸ“¤ Publicado em " + topic + ": " + JSON.stringify(data));
    };
  </script>
</body>
</html>
